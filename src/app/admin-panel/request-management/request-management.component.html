<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="layout-wrapper" [ngClass]="containerClass">
  <app-topbar></app-topbar>
  <div class="layout-sidebar">
    <app-sidebar></app-sidebar>
  </div>
  <div class="layout-main-container">
    <div class="layout-main">
      <div class="card">
        <h2 class="fw-bold text-center blue">Requests List</h2>
      </div>
      <div class="card">
        <div class="card-body">
          <p-table [value]="loadedReq">
            <ng-template pTemplate="header">
              <tr>
                <th>Date</th>
                <th>Subject</th>
                <th>department</th>
                <th>description</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-loadedReq>
              <tr>
                <td>{{ loadedReq.createdAt | date : "dd/MM/yyyy" }}</td>
                <td>{{ loadedReq.subject }}</td>
                <td>{{ loadedReq.department }}</td>
                <td>{{ loadedReq.description }}</td>

                <td>
                  <p-tag
                    *ngIf="loadedReq.status === 'treated'"
                    severity="success"
                    value="{{ loadedReq.status }}"
                  >
                  </p-tag>
                  <p-tag
                    *ngIf="loadedReq.status === 'waiting'"
                    severity="warning"
                    value="{{ loadedReq.status }}"
                  >
                  </p-tag>
                </td>
                <td>
                  <button
                    pButton
                    pRipple
                    type="button"
                    icon="pi pi-search"
                    class="p-button-rounded p-button-primary p-button-text"
                    (click)="showDialog(loadedReq)"
                  ></button>
                  <button
                    pButton
                    pRipple
                    type="button"
                    icon="pi pi-trash"
                    class="p-button-rounded p-button-danger p-button-text"
                    (click)="deleteRequest(loadedReq)"
                  ></button>
                 
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>

    <p-dialog
      header="Header"
      [(visible)]="visible"
      [breakpoints]="{ '960px': '75vw' }"
      [style]="{ width: '50vw' }"
      [draggable]="false"
      [resizable]="false"
    >
      <div class="surface-section">
        <div class="font-medium text-3xl text-900 mb-3">Request details</div>
        <ul class="list-none p-0 m-0">
          <li
            class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap"
          >
            <div class="text-500 w-6 md:w-2 font-medium">created At</div>
            <div class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1">
              {{ selectedRequest?.createdAt | date : "dd/MM/yyyy" }}
            </div>
            <div class="w-6 md:w-2 flex justify-content-end"></div>
          </li>
          <li
            class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap"
          >
            <div class="text-500 w-6 md:w-2 font-medium">status</div>
            <div class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1">
              <p-chip
                label="{{ selectedRequest?.status }}"
                class="mr-2"
              ></p-chip>
            </div>
            <div class="w-6 md:w-2 flex justify-content-end"></div>
          </li>
          <li
            class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap"
          >
            <div class="text-500 w-6 md:w-2 font-medium">subject</div>
            <div class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1">
              <td>{{ selectedRequest?.subject }}</td>
            </div>
            <div class="w-6 md:w-2 flex justify-content-end"></div>
          </li>
          <li
            class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap"
          >
            <div class="text-500 w-6 md:w-2 font-medium">department</div>
            <div class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1">
              {{ selectedRequest?.department }}
            </div>
            <div class="w-6 md:w-2 flex justify-content-end"></div>
          </li>
          <li
            class="flex align-items-center py-3 px-2 border-top-1 border-bottom-1 surface-border flex-wrap"
          >
            <div class="text-500 w-6 md:w-2 font-medium">description</div>
            <div
              class="text-900 w-full md:w-8 md:flex-order-0 flex-order-1 line-height-3"
            >
              {{ selectedRequest?.description }}
            </div>
          </li>
        </ul>
      </div>
      <ng-template pTemplate="footer">
        <p-button
          icon="pi pi-check"
          (click)="visible = false"
          (click)="confirmMarkAsTreated()"
          label="mark as treated"
          pAutoFocus
          [autofocus]="true"
        ></p-button>
        <p-button
          icon="pi pi-send"
          (click)="visible = false"
          label="send email"
          pAutoFocus
          [autofocus]="true"
        ></p-button>
      </ng-template>
    </p-dialog>

    <app-footer></app-footer>
  </div>
  <app-config></app-config>
  <div class="layout-mask"></div>
</div>
